{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { useWeb3React } from '@web3-react/core';\nimport BigNumber from 'bignumber.js';\nimport { useERC20, useIfoV2Contract } from 'hooks/useContract';\nimport useRefresh from 'hooks/useRefresh';\nimport { multicallv2 } from 'utils/multicall';\nimport ifoV2Abi from 'config/abi/ifoV2.json';\nimport { getAddress } from 'utils/addressHelpers';\nimport { BIG_ZERO } from 'utils/bigNumber';\nimport useIfoAllowance from '../useIfoAllowance';\n\n/**\n * Gets all data from an IFO related to a wallet\n */\nconst useGetWalletIfoData = ifo => {\n  _s();\n\n  const {\n    fastRefresh\n  } = useRefresh();\n  const [state, setState] = useState({\n    poolBasic: {\n      amountTokenCommittedInLP: BIG_ZERO,\n      offeringAmountInToken: BIG_ZERO,\n      refundingAmountInLP: BIG_ZERO,\n      taxAmountInLP: BIG_ZERO,\n      hasClaimed: false,\n      isPendingTx: false\n    },\n    poolUnlimited: {\n      amountTokenCommittedInLP: BIG_ZERO,\n      offeringAmountInToken: BIG_ZERO,\n      refundingAmountInLP: BIG_ZERO,\n      taxAmountInLP: BIG_ZERO,\n      hasClaimed: false,\n      isPendingTx: false\n    }\n  });\n  const {\n    address,\n    currency\n  } = ifo;\n  const {\n    account\n  } = useWeb3React();\n  const contract = useIfoV2Contract(address);\n  const currencyContract = useERC20(getAddress(currency.address));\n  const allowance = useIfoAllowance(currencyContract, address);\n\n  const setPendingTx = (status, poolId) => setState(prevState => ({ ...prevState,\n    [poolId]: { ...prevState[poolId],\n      isPendingTx: status\n    }\n  }));\n\n  const setIsClaimed = poolId => {\n    setState(prevState => ({ ...prevState,\n      [poolId]: { ...prevState[poolId],\n        hasClaimed: true\n      }\n    }));\n  };\n\n  const fetchIfoData = useCallback(async () => {\n    const ifoCalls = ['viewUserInfo', 'viewUserOfferingAndRefundingAmountsForPools'].map(method => ({\n      address,\n      name: method,\n      params: [account, [0, 1]]\n    }));\n    const [userInfo, amounts] = await multicallv2(ifoV2Abi, ifoCalls);\n    setState(prevState => ({ ...prevState,\n      poolBasic: { ...prevState.poolBasic,\n        amountTokenCommittedInLP: new BigNumber(userInfo[0][0].toString()),\n        offeringAmountInToken: new BigNumber(amounts[0][0][0].toString()),\n        refundingAmountInLP: new BigNumber(amounts[0][0][1].toString()),\n        taxAmountInLP: new BigNumber(amounts[0][0][2].toString()),\n        hasClaimed: userInfo[1][0]\n      },\n      poolUnlimited: { ...prevState.poolUnlimited,\n        amountTokenCommittedInLP: new BigNumber(userInfo[0][1].toString()),\n        offeringAmountInToken: new BigNumber(amounts[0][1][0].toString()),\n        refundingAmountInLP: new BigNumber(amounts[0][1][1].toString()),\n        taxAmountInLP: new BigNumber(amounts[0][1][2].toString()),\n        hasClaimed: userInfo[1][1]\n      }\n    }));\n  }, [account, address]);\n  useEffect(() => {\n    if (account) {\n      fetchIfoData();\n    }\n  }, [account, fetchIfoData, fastRefresh]);\n  return { ...state,\n    allowance,\n    contract,\n    setPendingTx,\n    setIsClaimed,\n    fetchIfoData\n  };\n};\n\n_s(useGetWalletIfoData, \"n56brgviGzvwtsKhegoTqttBsUU=\", false, function () {\n  return [useRefresh, useWeb3React, useIfoV2Contract, useERC20, useIfoAllowance];\n});\n\nexport default useGetWalletIfoData;","map":{"version":3,"sources":["/Users/thomas/Documents/pancake-frontend/pankcake-frontend/src/views/Ifos/hooks/v2/useGetWalletIfoData.ts"],"names":["useEffect","useState","useCallback","useWeb3React","BigNumber","useERC20","useIfoV2Contract","useRefresh","multicallv2","ifoV2Abi","getAddress","BIG_ZERO","useIfoAllowance","useGetWalletIfoData","ifo","fastRefresh","state","setState","poolBasic","amountTokenCommittedInLP","offeringAmountInToken","refundingAmountInLP","taxAmountInLP","hasClaimed","isPendingTx","poolUnlimited","address","currency","account","contract","currencyContract","allowance","setPendingTx","status","poolId","prevState","setIsClaimed","fetchIfoData","ifoCalls","map","method","name","params","userInfo","amounts","toString"],"mappings":"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","sourcesContent":["import { useEffect, useState, useCallback } from 'react'\nimport { useWeb3React } from '@web3-react/core'\nimport BigNumber from 'bignumber.js'\nimport { Ifo, PoolIds } from 'config/constants/types'\nimport { useERC20, useIfoV2Contract } from 'hooks/useContract'\nimport useRefresh from 'hooks/useRefresh'\nimport { multicallv2 } from 'utils/multicall'\nimport ifoV2Abi from 'config/abi/ifoV2.json'\nimport { getAddress } from 'utils/addressHelpers'\nimport { BIG_ZERO } from 'utils/bigNumber'\nimport useIfoAllowance from '../useIfoAllowance'\nimport { WalletIfoState, WalletIfoData } from '../../types'\n\n/**\n * Gets all data from an IFO related to a wallet\n */\nconst useGetWalletIfoData = (ifo: Ifo): WalletIfoData => {\n  const { fastRefresh } = useRefresh()\n  const [state, setState] = useState<WalletIfoState>({\n    poolBasic: {\n      amountTokenCommittedInLP: BIG_ZERO,\n      offeringAmountInToken: BIG_ZERO,\n      refundingAmountInLP: BIG_ZERO,\n      taxAmountInLP: BIG_ZERO,\n      hasClaimed: false,\n      isPendingTx: false,\n    },\n    poolUnlimited: {\n      amountTokenCommittedInLP: BIG_ZERO,\n      offeringAmountInToken: BIG_ZERO,\n      refundingAmountInLP: BIG_ZERO,\n      taxAmountInLP: BIG_ZERO,\n      hasClaimed: false,\n      isPendingTx: false,\n    },\n  })\n\n  const { address, currency } = ifo\n\n  const { account } = useWeb3React()\n  const contract = useIfoV2Contract(address)\n  const currencyContract = useERC20(getAddress(currency.address))\n  const allowance = useIfoAllowance(currencyContract, address)\n\n  const setPendingTx = (status: boolean, poolId: PoolIds) =>\n    setState((prevState) => ({\n      ...prevState,\n      [poolId]: {\n        ...prevState[poolId],\n        isPendingTx: status,\n      },\n    }))\n\n  const setIsClaimed = (poolId: PoolIds) => {\n    setState((prevState) => ({\n      ...prevState,\n      [poolId]: {\n        ...prevState[poolId],\n        hasClaimed: true,\n      },\n    }))\n  }\n\n  const fetchIfoData = useCallback(async () => {\n    const ifoCalls = ['viewUserInfo', 'viewUserOfferingAndRefundingAmountsForPools'].map((method) => ({\n      address,\n      name: method,\n      params: [account, [0, 1]],\n    }))\n\n    const [userInfo, amounts] = await multicallv2(ifoV2Abi, ifoCalls)\n\n    setState((prevState) => ({\n      ...prevState,\n      poolBasic: {\n        ...prevState.poolBasic,\n        amountTokenCommittedInLP: new BigNumber(userInfo[0][0].toString()),\n        offeringAmountInToken: new BigNumber(amounts[0][0][0].toString()),\n        refundingAmountInLP: new BigNumber(amounts[0][0][1].toString()),\n        taxAmountInLP: new BigNumber(amounts[0][0][2].toString()),\n        hasClaimed: userInfo[1][0],\n      },\n      poolUnlimited: {\n        ...prevState.poolUnlimited,\n        amountTokenCommittedInLP: new BigNumber(userInfo[0][1].toString()),\n        offeringAmountInToken: new BigNumber(amounts[0][1][0].toString()),\n        refundingAmountInLP: new BigNumber(amounts[0][1][1].toString()),\n        taxAmountInLP: new BigNumber(amounts[0][1][2].toString()),\n        hasClaimed: userInfo[1][1],\n      },\n    }))\n  }, [account, address])\n\n  useEffect(() => {\n    if (account) {\n      fetchIfoData()\n    }\n  }, [account, fetchIfoData, fastRefresh])\n\n  return { ...state, allowance, contract, setPendingTx, setIsClaimed, fetchIfoData }\n}\n\nexport default useGetWalletIfoData\n"]},"metadata":{},"sourceType":"module"}