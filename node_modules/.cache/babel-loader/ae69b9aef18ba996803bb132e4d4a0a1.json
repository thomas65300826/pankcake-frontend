{"ast":null,"code":"var _jsxFileName = \"/Users/thomas/Documents/PycharmProjects/pancake-frontend/src/views/Voting/CreateProposal/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { lazy, useEffect, useState, useMemo } from 'react';\nimport { AutoRenewIcon, Box, Breadcrumbs, Button, Card, CardBody, CardHeader, Flex, Heading, Input, LinkExternal, Text, useModal } from '@pancakeswap/uikit';\nimport { useHistory } from 'react-router';\nimport { useWeb3React } from '@web3-react/core';\nimport times from 'lodash/times';\nimport isEmpty from 'lodash/isEmpty';\nimport { useInitialBlock } from 'state/block/hooks';\nimport { SnapshotCommand } from 'state/types';\nimport useToast from 'hooks/useToast';\nimport useWeb3Provider from 'hooks/useActiveWeb3React';\nimport { getBscScanLink } from 'utils';\nimport truncateWalletAddress from 'utils/truncateWalletAddress';\nimport { signMessage } from 'utils/web3React';\nimport { useTranslation } from 'contexts/Localization';\nimport Container from 'components/Layout/Container';\nimport { DatePicker, TimePicker } from 'components/DatePicker';\nimport ConnectWalletButton from 'components/ConnectWalletButton';\nimport ReactMarkdown from 'components/ReactMarkdown';\nimport BreadcrumbLink from '../components/BreadcrumbLink';\nimport { sendSnaphotData, generateMetaData, generatePayloadData } from '../helpers';\nimport Layout from '../components/Layout';\nimport { FormErrors, Label, SecondaryLabel } from './styles';\nimport Choices, { makeChoice, MINIMUM_CHOICES } from './Choices';\nimport { combineDateAndTime, getFormErrors } from './helpers';\nimport { ADMIN_ADDRESS, VOTE_THRESHOLD } from '../config';\nimport VoteDetailsModal from '../components/VoteDetailsModal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst EasyMde = /*#__PURE__*/lazy(_c = () => import('components/EasyMde'));\n_c2 = EasyMde;\n\nconst CreateProposal = () => {\n  _s();\n\n  const [state, setState] = useState({\n    name: '',\n    body: '',\n    choices: times(MINIMUM_CHOICES).map(makeChoice),\n    startDate: null,\n    startTime: null,\n    endDate: null,\n    endTime: null,\n    snapshot: 0\n  });\n  const [isLoading, setIsLoading] = useState(false);\n  const [fieldsState, setFieldsState] = useState({});\n  const {\n    t\n  } = useTranslation();\n  const {\n    account\n  } = useWeb3React();\n  const initialBlock = useInitialBlock();\n  const {\n    push\n  } = useHistory();\n  const {\n    library\n  } = useWeb3Provider();\n  const {\n    toastSuccess,\n    toastError\n  } = useToast();\n  const [onPresentVoteDetailsModal] = useModal( /*#__PURE__*/_jsxDEV(VoteDetailsModal, {\n    block: state.snapshot\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 48\n  }, this));\n  const {\n    name,\n    body,\n    choices,\n    startDate,\n    startTime,\n    endDate,\n    endTime,\n    snapshot\n  } = state;\n  const formErrors = getFormErrors(state, t);\n\n  const handleSubmit = async evt => {\n    evt.preventDefault();\n\n    try {\n      setIsLoading(true);\n      const proposal = JSON.stringify({ ...generatePayloadData(),\n        type: SnapshotCommand.PROPOSAL,\n        payload: {\n          name,\n          body,\n          snapshot,\n          start: combineDateAndTime(startDate, startTime),\n          end: combineDateAndTime(endDate, endTime),\n          choices: choices.filter(choice => choice.value).map(choice => {\n            return choice.value;\n          }),\n          metadata: generateMetaData(),\n          type: 'single-choice'\n        }\n      });\n      const sig = await signMessage(library, account, proposal);\n\n      if (sig) {\n        const msg = {\n          address: account,\n          msg: proposal,\n          sig\n        }; // Save proposal to snapshot\n\n        const data = await sendSnaphotData(msg); // Redirect user to newly created proposal page\n\n        push(`/voting/proposal/${data.ipfsHash}`);\n        toastSuccess(t('Proposal created!'));\n      } else {\n        toastError(t('Error'), t('Unable to sign payload'));\n      }\n    } catch (error) {\n      toastError(t('Error'), (error === null || error === void 0 ? void 0 : error.message) || (error === null || error === void 0 ? void 0 : error.error));\n      console.error(error);\n      setIsLoading(false);\n    }\n  };\n\n  const updateValue = (key, value) => {\n    setState(prevState => ({ ...prevState,\n      [key]: value\n    })); // Keep track of what fields the user has attempted to edit\n\n    setFieldsState(prevFieldsState => ({ ...prevFieldsState,\n      [key]: true\n    }));\n  };\n\n  const handleChange = evt => {\n    const {\n      name: inputName,\n      value\n    } = evt.currentTarget;\n    updateValue(inputName, value);\n  };\n\n  const handleEasyMdeChange = value => {\n    updateValue('body', value);\n  };\n\n  const handleChoiceChange = newChoices => {\n    updateValue('choices', newChoices);\n  };\n\n  const handleDateChange = key => value => {\n    updateValue(key, value);\n  };\n\n  const options = useMemo(() => ({\n    hideIcons: account === ADMIN_ADDRESS ? [] : ['guide', 'fullscreen', 'preview', 'side-by-side', 'image']\n  }), [account]);\n  useEffect(() => {\n    if (initialBlock > 0) {\n      setState(prevState => ({ ...prevState,\n        snapshot: initialBlock\n      }));\n    }\n  }, [initialBlock, setState]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    py: \"40px\",\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      mb: \"48px\",\n      children: /*#__PURE__*/_jsxDEV(Breadcrumbs, {\n        children: [/*#__PURE__*/_jsxDEV(BreadcrumbLink, {\n          to: \"/\",\n          children: t('Home')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(BreadcrumbLink, {\n          to: \"/voting\",\n          children: t('Voting')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Text, {\n          children: t('Make a Proposal')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: /*#__PURE__*/_jsxDEV(Layout, {\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            mb: \"24px\",\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              htmlFor: \"name\",\n              children: t('Title')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Input, {\n              id: \"name\",\n              name: \"name\",\n              value: name,\n              scale: \"lg\",\n              onChange: handleChange,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 174,\n              columnNumber: 15\n            }, this), formErrors.name && fieldsState.name && /*#__PURE__*/_jsxDEV(FormErrors, {\n              errors: formErrors.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 55\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            mb: \"24px\",\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              htmlFor: \"body\",\n              children: t('Content')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Text, {\n              color: \"textSubtle\",\n              mb: \"8px\",\n              children: t('Tip: write in Markdown!')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(EasyMde, {\n              id: \"body\",\n              name: \"body\",\n              onTextChange: handleEasyMdeChange,\n              value: body,\n              options: options,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 15\n            }, this), formErrors.body && fieldsState.body && /*#__PURE__*/_jsxDEV(FormErrors, {\n              errors: formErrors.body\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 55\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 13\n          }, this), body && /*#__PURE__*/_jsxDEV(Box, {\n            mb: \"24px\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n                children: /*#__PURE__*/_jsxDEV(Heading, {\n                  as: \"h3\",\n                  scale: \"md\",\n                  children: t('Preview')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 196,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n                p: \"0\",\n                px: \"24px\",\n                children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                  children: body\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 201,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Choices, {\n            choices: choices,\n            onChange: handleChoiceChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 13\n          }, this), formErrors.choices && fieldsState.choices && /*#__PURE__*/_jsxDEV(FormErrors, {\n            errors: formErrors.choices\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 59\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n              children: /*#__PURE__*/_jsxDEV(Heading, {\n                as: \"h3\",\n                scale: \"md\",\n                children: t('Actions')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                mb: \"24px\",\n                children: [/*#__PURE__*/_jsxDEV(SecondaryLabel, {\n                  children: t('Start Date')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 218,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(DatePicker, {\n                  name: \"startDate\",\n                  onChange: handleDateChange('startDate'),\n                  selected: startDate,\n                  placeholderText: \"YYYY/MM/DD\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 219,\n                  columnNumber: 19\n                }, this), formErrors.startDate && fieldsState.startDate && /*#__PURE__*/_jsxDEV(FormErrors, {\n                  errors: formErrors.startDate\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 225,\n                  columnNumber: 69\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 217,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mb: \"24px\",\n                children: [/*#__PURE__*/_jsxDEV(SecondaryLabel, {\n                  children: t('Start Time')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 228,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TimePicker, {\n                  name: \"startTime\",\n                  onChange: handleDateChange('startTime'),\n                  selected: startTime,\n                  placeholderText: \"00:00\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 19\n                }, this), formErrors.startTime && fieldsState.startTime && /*#__PURE__*/_jsxDEV(FormErrors, {\n                  errors: formErrors.startTime\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 69\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 227,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mb: \"24px\",\n                children: [/*#__PURE__*/_jsxDEV(SecondaryLabel, {\n                  children: t('End Date')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(DatePicker, {\n                  name: \"endDate\",\n                  onChange: handleDateChange('endDate'),\n                  selected: endDate,\n                  placeholderText: \"YYYY/MM/DD\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 239,\n                  columnNumber: 19\n                }, this), formErrors.endDate && fieldsState.endDate && /*#__PURE__*/_jsxDEV(FormErrors, {\n                  errors: formErrors.endDate\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 65\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mb: \"24px\",\n                children: [/*#__PURE__*/_jsxDEV(SecondaryLabel, {\n                  children: t('End Time')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 248,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TimePicker, {\n                  name: \"endTime\",\n                  onChange: handleDateChange('endTime'),\n                  selected: endTime,\n                  placeholderText: \"00:00\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 249,\n                  columnNumber: 19\n                }, this), formErrors.endTime && fieldsState.endTime && /*#__PURE__*/_jsxDEV(FormErrors, {\n                  errors: formErrors.endTime\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 255,\n                  columnNumber: 65\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 247,\n                columnNumber: 17\n              }, this), account && /*#__PURE__*/_jsxDEV(Flex, {\n                alignItems: \"center\",\n                mb: \"8px\",\n                children: [/*#__PURE__*/_jsxDEV(Text, {\n                  color: \"textSubtle\",\n                  mr: \"16px\",\n                  children: t('Creator')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 259,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(LinkExternal, {\n                  href: getBscScanLink(account, 'address'),\n                  children: truncateWalletAddress(account)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 262,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 258,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Flex, {\n                alignItems: \"center\",\n                mb: \"16px\",\n                children: [/*#__PURE__*/_jsxDEV(Text, {\n                  color: \"textSubtle\",\n                  mr: \"16px\",\n                  children: t('Snapshot')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 268,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(LinkExternal, {\n                  href: getBscScanLink(snapshot, 'block'),\n                  children: snapshot\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 271,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 17\n              }, this), account ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  type: \"submit\",\n                  width: \"100%\",\n                  isLoading: isLoading,\n                  endIcon: isLoading ? /*#__PURE__*/_jsxDEV(AutoRenewIcon, {\n                    spin: true,\n                    color: \"currentColor\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 279,\n                    columnNumber: 44\n                  }, this) : null,\n                  disabled: !isEmpty(formErrors),\n                  mb: \"16px\",\n                  children: t('Publish')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 275,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Text, {\n                  color: \"failure\",\n                  as: \"p\",\n                  mb: \"4px\",\n                  children: [t('You need at least %count% voting power to publish a proposal.', {\n                    count: VOTE_THRESHOLD\n                  }), ' ']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 285,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  scale: \"sm\",\n                  type: \"button\",\n                  variant: \"text\",\n                  onClick: onPresentVoteDetailsModal,\n                  p: 0,\n                  children: t('Check voting power')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 288,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(ConnectWalletButton, {\n                width: \"100%\",\n                type: \"button\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 293,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n};\n\n_s(CreateProposal, \"ufgx56GRPBvoOo8HSS7E6/+mna4=\", false, function () {\n  return [useTranslation, useWeb3React, useInitialBlock, useHistory, useWeb3Provider, useToast, useModal];\n});\n\n_c3 = CreateProposal;\nexport default CreateProposal;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"EasyMde$lazy\");\n$RefreshReg$(_c2, \"EasyMde\");\n$RefreshReg$(_c3, \"CreateProposal\");","map":{"version":3,"sources":["/Users/thomas/Documents/PycharmProjects/pancake-frontend/src/views/Voting/CreateProposal/index.tsx"],"names":["React","lazy","useEffect","useState","useMemo","AutoRenewIcon","Box","Breadcrumbs","Button","Card","CardBody","CardHeader","Flex","Heading","Input","LinkExternal","Text","useModal","useHistory","useWeb3React","times","isEmpty","useInitialBlock","SnapshotCommand","useToast","useWeb3Provider","getBscScanLink","truncateWalletAddress","signMessage","useTranslation","Container","DatePicker","TimePicker","ConnectWalletButton","ReactMarkdown","BreadcrumbLink","sendSnaphotData","generateMetaData","generatePayloadData","Layout","FormErrors","Label","SecondaryLabel","Choices","makeChoice","MINIMUM_CHOICES","combineDateAndTime","getFormErrors","ADMIN_ADDRESS","VOTE_THRESHOLD","VoteDetailsModal","EasyMde","CreateProposal","state","setState","name","body","choices","map","startDate","startTime","endDate","endTime","snapshot","isLoading","setIsLoading","fieldsState","setFieldsState","t","account","initialBlock","push","library","toastSuccess","toastError","onPresentVoteDetailsModal","formErrors","handleSubmit","evt","preventDefault","proposal","JSON","stringify","type","PROPOSAL","payload","start","end","filter","choice","value","metadata","sig","msg","address","data","ipfsHash","error","message","console","updateValue","key","prevState","prevFieldsState","handleChange","inputName","currentTarget","handleEasyMdeChange","handleChoiceChange","newChoices","handleDateChange","options","hideIcons","count"],"mappings":";;;AAAA,OAAOA,KAAP,IAAwCC,IAAxC,EAA8CC,SAA9C,EAAyDC,QAAzD,EAAmEC,OAAnE,QAAkF,OAAlF;AACA,SACEC,aADF,EAEEC,GAFF,EAGEC,WAHF,EAIEC,MAJF,EAKEC,IALF,EAMEC,QANF,EAOEC,UAPF,EAQEC,IARF,EASEC,OATF,EAUEC,KAVF,EAWEC,YAXF,EAYEC,IAZF,EAaEC,QAbF,QAcO,oBAdP;AAeA,SAASC,UAAT,QAA2B,cAA3B;AACA,SAASC,YAAT,QAA6B,kBAA7B;AACA,OAAOC,KAAP,MAAkB,cAAlB;AACA,OAAOC,OAAP,MAAoB,gBAApB;AACA,SAASC,eAAT,QAAgC,mBAAhC;AACA,SAASC,eAAT,QAAgC,aAAhC;AACA,OAAOC,QAAP,MAAqB,gBAArB;AACA,OAAOC,eAAP,MAA4B,0BAA5B;AACA,SAASC,cAAT,QAA+B,OAA/B;AACA,OAAOC,qBAAP,MAAkC,6BAAlC;AACA,SAASC,WAAT,QAA4B,iBAA5B;AACA,SAASC,cAAT,QAA+B,uBAA/B;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,SAASC,UAAT,EAAqBC,UAArB,QAAuC,uBAAvC;AACA,OAAOC,mBAAP,MAAgC,gCAAhC;AACA,OAAOC,aAAP,MAA0B,0BAA1B;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AACA,SAASC,eAAT,EAAmCC,gBAAnC,EAAqDC,mBAArD,QAAgF,YAAhF;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,SAASC,UAAT,EAAqBC,KAArB,EAA4BC,cAA5B,QAAkD,UAAlD;AACA,OAAOC,OAAP,IAA0BC,UAA1B,EAAsCC,eAAtC,QAA6D,WAA7D;AACA,SAASC,kBAAT,EAA6BC,aAA7B,QAAkD,WAAlD;AAEA,SAASC,aAAT,EAAwBC,cAAxB,QAA8C,WAA9C;AACA,OAAOC,gBAAP,MAA6B,gCAA7B;;;AAEA,MAAMC,OAAO,gBAAGlD,IAAI,MAAC,MAAM,OAAO,oBAAP,CAAP,CAApB;MAAMkD,O;;AAEN,MAAMC,cAAc,GAAG,MAAM;AAAA;;AAC3B,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBnD,QAAQ,CAAY;AAC5CoD,IAAAA,IAAI,EAAE,EADsC;AAE5CC,IAAAA,IAAI,EAAE,EAFsC;AAG5CC,IAAAA,OAAO,EAAErC,KAAK,CAACyB,eAAD,CAAL,CAAuBa,GAAvB,CAA2Bd,UAA3B,CAHmC;AAI5Ce,IAAAA,SAAS,EAAE,IAJiC;AAK5CC,IAAAA,SAAS,EAAE,IALiC;AAM5CC,IAAAA,OAAO,EAAE,IANmC;AAO5CC,IAAAA,OAAO,EAAE,IAPmC;AAQ5CC,IAAAA,QAAQ,EAAE;AARkC,GAAZ,CAAlC;AAUA,QAAM,CAACC,SAAD,EAAYC,YAAZ,IAA4B9D,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAAC+D,WAAD,EAAcC,cAAd,IAAgChE,QAAQ,CAA6B,EAA7B,CAA9C;AACA,QAAM;AAAEiE,IAAAA;AAAF,MAAQvC,cAAc,EAA5B;AACA,QAAM;AAAEwC,IAAAA;AAAF,MAAclD,YAAY,EAAhC;AACA,QAAMmD,YAAY,GAAGhD,eAAe,EAApC;AACA,QAAM;AAAEiD,IAAAA;AAAF,MAAWrD,UAAU,EAA3B;AACA,QAAM;AAAEsD,IAAAA;AAAF,MAAc/C,eAAe,EAAnC;AACA,QAAM;AAAEgD,IAAAA,YAAF;AAAgBC,IAAAA;AAAhB,MAA+BlD,QAAQ,EAA7C;AACA,QAAM,CAACmD,yBAAD,IAA8B1D,QAAQ,eAAC,QAAC,gBAAD;AAAkB,IAAA,KAAK,EAAEoC,KAAK,CAACU;AAA/B;AAAA;AAAA;AAAA;AAAA,UAAD,CAA5C;AACA,QAAM;AAAER,IAAAA,IAAF;AAAQC,IAAAA,IAAR;AAAcC,IAAAA,OAAd;AAAuBE,IAAAA,SAAvB;AAAkCC,IAAAA,SAAlC;AAA6CC,IAAAA,OAA7C;AAAsDC,IAAAA,OAAtD;AAA+DC,IAAAA;AAA/D,MAA4EV,KAAlF;AACA,QAAMuB,UAAU,GAAG7B,aAAa,CAACM,KAAD,EAAQe,CAAR,CAAhC;;AAEA,QAAMS,YAAY,GAAG,MAAOC,GAAP,IAA2C;AAC9DA,IAAAA,GAAG,CAACC,cAAJ;;AAEA,QAAI;AACFd,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACA,YAAMe,QAAQ,GAAGC,IAAI,CAACC,SAAL,CAAe,EAC9B,GAAG5C,mBAAmB,EADQ;AAE9B6C,QAAAA,IAAI,EAAE5D,eAAe,CAAC6D,QAFQ;AAG9BC,QAAAA,OAAO,EAAE;AACP9B,UAAAA,IADO;AAEPC,UAAAA,IAFO;AAGPO,UAAAA,QAHO;AAIPuB,UAAAA,KAAK,EAAExC,kBAAkB,CAACa,SAAD,EAAYC,SAAZ,CAJlB;AAKP2B,UAAAA,GAAG,EAAEzC,kBAAkB,CAACe,OAAD,EAAUC,OAAV,CALhB;AAMPL,UAAAA,OAAO,EAAEA,OAAO,CACb+B,MADM,CACEC,MAAD,IAAYA,MAAM,CAACC,KADpB,EAENhC,GAFM,CAED+B,MAAD,IAAY;AACf,mBAAOA,MAAM,CAACC,KAAd;AACD,WAJM,CANF;AAWPC,UAAAA,QAAQ,EAAEtD,gBAAgB,EAXnB;AAYP8C,UAAAA,IAAI,EAAE;AAZC;AAHqB,OAAf,CAAjB;AAmBA,YAAMS,GAAG,GAAG,MAAMhE,WAAW,CAAC4C,OAAD,EAAUH,OAAV,EAAmBW,QAAnB,CAA7B;;AAEA,UAAIY,GAAJ,EAAS;AACP,cAAMC,GAAY,GAAG;AAAEC,UAAAA,OAAO,EAAEzB,OAAX;AAAoBwB,UAAAA,GAAG,EAAEb,QAAzB;AAAmCY,UAAAA;AAAnC,SAArB,CADO,CAGP;;AACA,cAAMG,IAAI,GAAG,MAAM3D,eAAe,CAACyD,GAAD,CAAlC,CAJO,CAMP;;AACAtB,QAAAA,IAAI,CAAE,oBAAmBwB,IAAI,CAACC,QAAS,EAAnC,CAAJ;AAEAvB,QAAAA,YAAY,CAACL,CAAC,CAAC,mBAAD,CAAF,CAAZ;AACD,OAVD,MAUO;AACLM,QAAAA,UAAU,CAACN,CAAC,CAAC,OAAD,CAAF,EAAaA,CAAC,CAAC,wBAAD,CAAd,CAAV;AACD;AACF,KApCD,CAoCE,OAAO6B,KAAP,EAAc;AACdvB,MAAAA,UAAU,CAACN,CAAC,CAAC,OAAD,CAAF,EAAa,CAAA6B,KAAK,SAAL,IAAAA,KAAK,WAAL,YAAAA,KAAK,CAAEC,OAAP,MAAkBD,KAAlB,aAAkBA,KAAlB,uBAAkBA,KAAK,CAAEA,KAAzB,CAAb,CAAV;AACAE,MAAAA,OAAO,CAACF,KAAR,CAAcA,KAAd;AACAhC,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;AACF,GA5CD;;AA8CA,QAAMmC,WAAW,GAAG,CAACC,GAAD,EAAcX,KAAd,KAAkD;AACpEpC,IAAAA,QAAQ,CAAEgD,SAAD,KAAgB,EACvB,GAAGA,SADoB;AAEvB,OAACD,GAAD,GAAOX;AAFgB,KAAhB,CAAD,CAAR,CADoE,CAMpE;;AACAvB,IAAAA,cAAc,CAAEoC,eAAD,KAAsB,EACnC,GAAGA,eADgC;AAEnC,OAACF,GAAD,GAAO;AAF4B,KAAtB,CAAD,CAAd;AAID,GAXD;;AAaA,QAAMG,YAAY,GAAI1B,GAAD,IAAwC;AAC3D,UAAM;AAAEvB,MAAAA,IAAI,EAAEkD,SAAR;AAAmBf,MAAAA;AAAnB,QAA6BZ,GAAG,CAAC4B,aAAvC;AACAN,IAAAA,WAAW,CAACK,SAAD,EAAYf,KAAZ,CAAX;AACD,GAHD;;AAKA,QAAMiB,mBAAmB,GAAIjB,KAAD,IAAmB;AAC7CU,IAAAA,WAAW,CAAC,MAAD,EAASV,KAAT,CAAX;AACD,GAFD;;AAIA,QAAMkB,kBAAkB,GAAIC,UAAD,IAA0B;AACnDT,IAAAA,WAAW,CAAC,SAAD,EAAYS,UAAZ,CAAX;AACD,GAFD;;AAIA,QAAMC,gBAAgB,GAAIT,GAAD,IAAkBX,KAAD,IAAiB;AACzDU,IAAAA,WAAW,CAACC,GAAD,EAAMX,KAAN,CAAX;AACD,GAFD;;AAIA,QAAMqB,OAAO,GAAG3G,OAAO,CACrB,OAAO;AACL4G,IAAAA,SAAS,EAAE3C,OAAO,KAAKrB,aAAZ,GAA4B,EAA5B,GAAiC,CAAC,OAAD,EAAU,YAAV,EAAwB,SAAxB,EAAmC,cAAnC,EAAmD,OAAnD;AADvC,GAAP,CADqB,EAIrB,CAACqB,OAAD,CAJqB,CAAvB;AAOAnE,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIoE,YAAY,GAAG,CAAnB,EAAsB;AACpBhB,MAAAA,QAAQ,CAAEgD,SAAD,KAAgB,EACvB,GAAGA,SADoB;AAEvBvC,QAAAA,QAAQ,EAAEO;AAFa,OAAhB,CAAD,CAAR;AAID;AACF,GAPQ,EAON,CAACA,YAAD,EAAehB,QAAf,CAPM,CAAT;AASA,sBACE,QAAC,SAAD;AAAW,IAAA,EAAE,EAAC,MAAd;AAAA,4BACE,QAAC,GAAD;AAAK,MAAA,EAAE,EAAC,MAAR;AAAA,6BACE,QAAC,WAAD;AAAA,gCACE,QAAC,cAAD;AAAgB,UAAA,EAAE,EAAC,GAAnB;AAAA,oBAAwBc,CAAC,CAAC,MAAD;AAAzB;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE,QAAC,cAAD;AAAgB,UAAA,EAAE,EAAC,SAAnB;AAAA,oBAA8BA,CAAC,CAAC,QAAD;AAA/B;AAAA;AAAA;AAAA;AAAA,gBAFF,eAGE,QAAC,IAAD;AAAA,oBAAOA,CAAC,CAAC,iBAAD;AAAR;AAAA;AAAA;AAAA;AAAA,gBAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF,eAQE;AAAM,MAAA,QAAQ,EAAES,YAAhB;AAAA,6BACE,QAAC,MAAD;AAAA,gCACE,QAAC,GAAD;AAAA,kCACE,QAAC,GAAD;AAAK,YAAA,EAAE,EAAC,MAAR;AAAA,oCACE,QAAC,KAAD;AAAO,cAAA,OAAO,EAAC,MAAf;AAAA,wBAAuBT,CAAC,CAAC,OAAD;AAAxB;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE,QAAC,KAAD;AAAO,cAAA,EAAE,EAAC,MAAV;AAAiB,cAAA,IAAI,EAAC,MAAtB;AAA6B,cAAA,KAAK,EAAEb,IAApC;AAA0C,cAAA,KAAK,EAAC,IAAhD;AAAqD,cAAA,QAAQ,EAAEiD,YAA/D;AAA6E,cAAA,QAAQ;AAArF;AAAA;AAAA;AAAA;AAAA,oBAFF,EAGG5B,UAAU,CAACrB,IAAX,IAAmBW,WAAW,CAACX,IAA/B,iBAAuC,QAAC,UAAD;AAAY,cAAA,MAAM,EAAEqB,UAAU,CAACrB;AAA/B;AAAA;AAAA;AAAA;AAAA,oBAH1C;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAME,QAAC,GAAD;AAAK,YAAA,EAAE,EAAC,MAAR;AAAA,oCACE,QAAC,KAAD;AAAO,cAAA,OAAO,EAAC,MAAf;AAAA,wBAAuBa,CAAC,CAAC,SAAD;AAAxB;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE,QAAC,IAAD;AAAM,cAAA,KAAK,EAAC,YAAZ;AAAyB,cAAA,EAAE,EAAC,KAA5B;AAAA,wBACGA,CAAC,CAAC,yBAAD;AADJ;AAAA;AAAA;AAAA;AAAA,oBAFF,eAKE,QAAC,OAAD;AACE,cAAA,EAAE,EAAC,MADL;AAEE,cAAA,IAAI,EAAC,MAFP;AAGE,cAAA,YAAY,EAAEuC,mBAHhB;AAIE,cAAA,KAAK,EAAEnD,IAJT;AAKE,cAAA,OAAO,EAAEuD,OALX;AAME,cAAA,QAAQ;AANV;AAAA;AAAA;AAAA;AAAA,oBALF,EAaGnC,UAAU,CAACpB,IAAX,IAAmBU,WAAW,CAACV,IAA/B,iBAAuC,QAAC,UAAD;AAAY,cAAA,MAAM,EAAEoB,UAAU,CAACpB;AAA/B;AAAA;AAAA;AAAA;AAAA,oBAb1C;AAAA;AAAA;AAAA;AAAA;AAAA,kBANF,EAqBGA,IAAI,iBACH,QAAC,GAAD;AAAK,YAAA,EAAE,EAAC,MAAR;AAAA,mCACE,QAAC,IAAD;AAAA,sCACE,QAAC,UAAD;AAAA,uCACE,QAAC,OAAD;AAAS,kBAAA,EAAE,EAAC,IAAZ;AAAiB,kBAAA,KAAK,EAAC,IAAvB;AAAA,4BACGY,CAAC,CAAC,SAAD;AADJ;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBADF,eAME,QAAC,QAAD;AAAU,gBAAA,CAAC,EAAC,GAAZ;AAAgB,gBAAA,EAAE,EAAC,MAAnB;AAAA,uCACE,QAAC,aAAD;AAAA,4BAAgBZ;AAAhB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBANF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBAtBJ,eAmCE,QAAC,OAAD;AAAS,YAAA,OAAO,EAAEC,OAAlB;AAA2B,YAAA,QAAQ,EAAEmD;AAArC;AAAA;AAAA;AAAA;AAAA,kBAnCF,EAoCGhC,UAAU,CAACnB,OAAX,IAAsBS,WAAW,CAACT,OAAlC,iBAA6C,QAAC,UAAD;AAAY,YAAA,MAAM,EAAEmB,UAAU,CAACnB;AAA/B;AAAA;AAAA;AAAA;AAAA,kBApChD;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAuCE,QAAC,GAAD;AAAA,iCACE,QAAC,IAAD;AAAA,oCACE,QAAC,UAAD;AAAA,qCACE,QAAC,OAAD;AAAS,gBAAA,EAAE,EAAC,IAAZ;AAAiB,gBAAA,KAAK,EAAC,IAAvB;AAAA,0BACGW,CAAC,CAAC,SAAD;AADJ;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eAME,QAAC,QAAD;AAAA,sCACE,QAAC,GAAD;AAAK,gBAAA,EAAE,EAAC,MAAR;AAAA,wCACE,QAAC,cAAD;AAAA,4BAAiBA,CAAC,CAAC,YAAD;AAAlB;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE,QAAC,UAAD;AACE,kBAAA,IAAI,EAAC,WADP;AAEE,kBAAA,QAAQ,EAAE0C,gBAAgB,CAAC,WAAD,CAF5B;AAGE,kBAAA,QAAQ,EAAEnD,SAHZ;AAIE,kBAAA,eAAe,EAAC;AAJlB;AAAA;AAAA;AAAA;AAAA,wBAFF,EAQGiB,UAAU,CAACjB,SAAX,IAAwBO,WAAW,CAACP,SAApC,iBAAiD,QAAC,UAAD;AAAY,kBAAA,MAAM,EAAEiB,UAAU,CAACjB;AAA/B;AAAA;AAAA;AAAA;AAAA,wBARpD;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAWE,QAAC,GAAD;AAAK,gBAAA,EAAE,EAAC,MAAR;AAAA,wCACE,QAAC,cAAD;AAAA,4BAAiBS,CAAC,CAAC,YAAD;AAAlB;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE,QAAC,UAAD;AACE,kBAAA,IAAI,EAAC,WADP;AAEE,kBAAA,QAAQ,EAAE0C,gBAAgB,CAAC,WAAD,CAF5B;AAGE,kBAAA,QAAQ,EAAElD,SAHZ;AAIE,kBAAA,eAAe,EAAC;AAJlB;AAAA;AAAA;AAAA;AAAA,wBAFF,EAQGgB,UAAU,CAAChB,SAAX,IAAwBM,WAAW,CAACN,SAApC,iBAAiD,QAAC,UAAD;AAAY,kBAAA,MAAM,EAAEgB,UAAU,CAAChB;AAA/B;AAAA;AAAA;AAAA;AAAA,wBARpD;AAAA;AAAA;AAAA;AAAA;AAAA,sBAXF,eAqBE,QAAC,GAAD;AAAK,gBAAA,EAAE,EAAC,MAAR;AAAA,wCACE,QAAC,cAAD;AAAA,4BAAiBQ,CAAC,CAAC,UAAD;AAAlB;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE,QAAC,UAAD;AACE,kBAAA,IAAI,EAAC,SADP;AAEE,kBAAA,QAAQ,EAAE0C,gBAAgB,CAAC,SAAD,CAF5B;AAGE,kBAAA,QAAQ,EAAEjD,OAHZ;AAIE,kBAAA,eAAe,EAAC;AAJlB;AAAA;AAAA;AAAA;AAAA,wBAFF,EAQGe,UAAU,CAACf,OAAX,IAAsBK,WAAW,CAACL,OAAlC,iBAA6C,QAAC,UAAD;AAAY,kBAAA,MAAM,EAAEe,UAAU,CAACf;AAA/B;AAAA;AAAA;AAAA;AAAA,wBARhD;AAAA;AAAA;AAAA;AAAA;AAAA,sBArBF,eA+BE,QAAC,GAAD;AAAK,gBAAA,EAAE,EAAC,MAAR;AAAA,wCACE,QAAC,cAAD;AAAA,4BAAiBO,CAAC,CAAC,UAAD;AAAlB;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE,QAAC,UAAD;AACE,kBAAA,IAAI,EAAC,SADP;AAEE,kBAAA,QAAQ,EAAE0C,gBAAgB,CAAC,SAAD,CAF5B;AAGE,kBAAA,QAAQ,EAAEhD,OAHZ;AAIE,kBAAA,eAAe,EAAC;AAJlB;AAAA;AAAA;AAAA;AAAA,wBAFF,EAQGc,UAAU,CAACd,OAAX,IAAsBI,WAAW,CAACJ,OAAlC,iBAA6C,QAAC,UAAD;AAAY,kBAAA,MAAM,EAAEc,UAAU,CAACd;AAA/B;AAAA;AAAA;AAAA;AAAA,wBARhD;AAAA;AAAA;AAAA;AAAA;AAAA,sBA/BF,EAyCGO,OAAO,iBACN,QAAC,IAAD;AAAM,gBAAA,UAAU,EAAC,QAAjB;AAA0B,gBAAA,EAAE,EAAC,KAA7B;AAAA,wCACE,QAAC,IAAD;AAAM,kBAAA,KAAK,EAAC,YAAZ;AAAyB,kBAAA,EAAE,EAAC,MAA5B;AAAA,4BACGD,CAAC,CAAC,SAAD;AADJ;AAAA;AAAA;AAAA;AAAA,wBADF,eAIE,QAAC,YAAD;AAAc,kBAAA,IAAI,EAAE1C,cAAc,CAAC2C,OAAD,EAAU,SAAV,CAAlC;AAAA,4BACG1C,qBAAqB,CAAC0C,OAAD;AADxB;AAAA;AAAA;AAAA;AAAA,wBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,sBA1CJ,eAmDE,QAAC,IAAD;AAAM,gBAAA,UAAU,EAAC,QAAjB;AAA0B,gBAAA,EAAE,EAAC,MAA7B;AAAA,wCACE,QAAC,IAAD;AAAM,kBAAA,KAAK,EAAC,YAAZ;AAAyB,kBAAA,EAAE,EAAC,MAA5B;AAAA,4BACGD,CAAC,CAAC,UAAD;AADJ;AAAA;AAAA;AAAA;AAAA,wBADF,eAIE,QAAC,YAAD;AAAc,kBAAA,IAAI,EAAE1C,cAAc,CAACqC,QAAD,EAAW,OAAX,CAAlC;AAAA,4BAAwDA;AAAxD;AAAA;AAAA;AAAA;AAAA,wBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,sBAnDF,EAyDGM,OAAO,gBACN;AAAA,wCACE,QAAC,MAAD;AACE,kBAAA,IAAI,EAAC,QADP;AAEE,kBAAA,KAAK,EAAC,MAFR;AAGE,kBAAA,SAAS,EAAEL,SAHb;AAIE,kBAAA,OAAO,EAAEA,SAAS,gBAAG,QAAC,aAAD;AAAe,oBAAA,IAAI,MAAnB;AAAoB,oBAAA,KAAK,EAAC;AAA1B;AAAA;AAAA;AAAA;AAAA,0BAAH,GAAiD,IAJrE;AAKE,kBAAA,QAAQ,EAAE,CAAC3C,OAAO,CAACuD,UAAD,CALpB;AAME,kBAAA,EAAE,EAAC,MANL;AAAA,4BAQGR,CAAC,CAAC,SAAD;AARJ;AAAA;AAAA;AAAA;AAAA,wBADF,eAWE,QAAC,IAAD;AAAM,kBAAA,KAAK,EAAC,SAAZ;AAAsB,kBAAA,EAAE,EAAC,GAAzB;AAA6B,kBAAA,EAAE,EAAC,KAAhC;AAAA,6BACGA,CAAC,CAAC,+DAAD,EAAkE;AAAE6C,oBAAAA,KAAK,EAAEhE;AAAT,mBAAlE,CADJ,EACkG,GADlG;AAAA;AAAA;AAAA;AAAA;AAAA,wBAXF,eAcE,QAAC,MAAD;AAAQ,kBAAA,KAAK,EAAC,IAAd;AAAmB,kBAAA,IAAI,EAAC,QAAxB;AAAiC,kBAAA,OAAO,EAAC,MAAzC;AAAgD,kBAAA,OAAO,EAAE0B,yBAAzD;AAAoF,kBAAA,CAAC,EAAE,CAAvF;AAAA,4BACGP,CAAC,CAAC,oBAAD;AADJ;AAAA;AAAA;AAAA;AAAA,wBAdF;AAAA,8BADM,gBAoBN,QAAC,mBAAD;AAAqB,gBAAA,KAAK,EAAC,MAA3B;AAAkC,gBAAA,IAAI,EAAC;AAAvC;AAAA;AAAA;AAAA;AAAA,sBA7EJ;AAAA;AAAA;AAAA;AAAA;AAAA,oBANF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAvCF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YARF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AA8ID,CAjQD;;GAAMhB,c;UAaUvB,c,EACMV,Y,EACCG,e,EACJJ,U,EACGO,e,EACiBD,Q,EACDP,Q;;;MAnBhCmC,c;AAmQN,eAAeA,cAAf","sourcesContent":["import React, { ChangeEvent, FormEvent, lazy, useEffect, useState, useMemo } from 'react'\nimport {\n  AutoRenewIcon,\n  Box,\n  Breadcrumbs,\n  Button,\n  Card,\n  CardBody,\n  CardHeader,\n  Flex,\n  Heading,\n  Input,\n  LinkExternal,\n  Text,\n  useModal,\n} from '@pancakeswap/uikit'\nimport { useHistory } from 'react-router'\nimport { useWeb3React } from '@web3-react/core'\nimport times from 'lodash/times'\nimport isEmpty from 'lodash/isEmpty'\nimport { useInitialBlock } from 'state/block/hooks'\nimport { SnapshotCommand } from 'state/types'\nimport useToast from 'hooks/useToast'\nimport useWeb3Provider from 'hooks/useActiveWeb3React'\nimport { getBscScanLink } from 'utils'\nimport truncateWalletAddress from 'utils/truncateWalletAddress'\nimport { signMessage } from 'utils/web3React'\nimport { useTranslation } from 'contexts/Localization'\nimport Container from 'components/Layout/Container'\nimport { DatePicker, TimePicker } from 'components/DatePicker'\nimport ConnectWalletButton from 'components/ConnectWalletButton'\nimport ReactMarkdown from 'components/ReactMarkdown'\nimport BreadcrumbLink from '../components/BreadcrumbLink'\nimport { sendSnaphotData, Message, generateMetaData, generatePayloadData } from '../helpers'\nimport Layout from '../components/Layout'\nimport { FormErrors, Label, SecondaryLabel } from './styles'\nimport Choices, { Choice, makeChoice, MINIMUM_CHOICES } from './Choices'\nimport { combineDateAndTime, getFormErrors } from './helpers'\nimport { FormState } from './types'\nimport { ADMIN_ADDRESS, VOTE_THRESHOLD } from '../config'\nimport VoteDetailsModal from '../components/VoteDetailsModal'\n\nconst EasyMde = lazy(() => import('components/EasyMde'))\n\nconst CreateProposal = () => {\n  const [state, setState] = useState<FormState>({\n    name: '',\n    body: '',\n    choices: times(MINIMUM_CHOICES).map(makeChoice),\n    startDate: null,\n    startTime: null,\n    endDate: null,\n    endTime: null,\n    snapshot: 0,\n  })\n  const [isLoading, setIsLoading] = useState(false)\n  const [fieldsState, setFieldsState] = useState<{ [key: string]: boolean }>({})\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const initialBlock = useInitialBlock()\n  const { push } = useHistory()\n  const { library } = useWeb3Provider()\n  const { toastSuccess, toastError } = useToast()\n  const [onPresentVoteDetailsModal] = useModal(<VoteDetailsModal block={state.snapshot} />)\n  const { name, body, choices, startDate, startTime, endDate, endTime, snapshot } = state\n  const formErrors = getFormErrors(state, t)\n\n  const handleSubmit = async (evt: FormEvent<HTMLFormElement>) => {\n    evt.preventDefault()\n\n    try {\n      setIsLoading(true)\n      const proposal = JSON.stringify({\n        ...generatePayloadData(),\n        type: SnapshotCommand.PROPOSAL,\n        payload: {\n          name,\n          body,\n          snapshot,\n          start: combineDateAndTime(startDate, startTime),\n          end: combineDateAndTime(endDate, endTime),\n          choices: choices\n            .filter((choice) => choice.value)\n            .map((choice) => {\n              return choice.value\n            }),\n          metadata: generateMetaData(),\n          type: 'single-choice',\n        },\n      })\n\n      const sig = await signMessage(library, account, proposal)\n\n      if (sig) {\n        const msg: Message = { address: account, msg: proposal, sig }\n\n        // Save proposal to snapshot\n        const data = await sendSnaphotData(msg)\n\n        // Redirect user to newly created proposal page\n        push(`/voting/proposal/${data.ipfsHash}`)\n\n        toastSuccess(t('Proposal created!'))\n      } else {\n        toastError(t('Error'), t('Unable to sign payload'))\n      }\n    } catch (error) {\n      toastError(t('Error'), error?.message || error?.error)\n      console.error(error)\n      setIsLoading(false)\n    }\n  }\n\n  const updateValue = (key: string, value: string | Choice[] | Date) => {\n    setState((prevState) => ({\n      ...prevState,\n      [key]: value,\n    }))\n\n    // Keep track of what fields the user has attempted to edit\n    setFieldsState((prevFieldsState) => ({\n      ...prevFieldsState,\n      [key]: true,\n    }))\n  }\n\n  const handleChange = (evt: ChangeEvent<HTMLInputElement>) => {\n    const { name: inputName, value } = evt.currentTarget\n    updateValue(inputName, value)\n  }\n\n  const handleEasyMdeChange = (value: string) => {\n    updateValue('body', value)\n  }\n\n  const handleChoiceChange = (newChoices: Choice[]) => {\n    updateValue('choices', newChoices)\n  }\n\n  const handleDateChange = (key: string) => (value: Date) => {\n    updateValue(key, value)\n  }\n\n  const options = useMemo(\n    () => ({\n      hideIcons: account === ADMIN_ADDRESS ? [] : ['guide', 'fullscreen', 'preview', 'side-by-side', 'image'],\n    }),\n    [account],\n  )\n\n  useEffect(() => {\n    if (initialBlock > 0) {\n      setState((prevState) => ({\n        ...prevState,\n        snapshot: initialBlock,\n      }))\n    }\n  }, [initialBlock, setState])\n\n  return (\n    <Container py=\"40px\">\n      <Box mb=\"48px\">\n        <Breadcrumbs>\n          <BreadcrumbLink to=\"/\">{t('Home')}</BreadcrumbLink>\n          <BreadcrumbLink to=\"/voting\">{t('Voting')}</BreadcrumbLink>\n          <Text>{t('Make a Proposal')}</Text>\n        </Breadcrumbs>\n      </Box>\n      <form onSubmit={handleSubmit}>\n        <Layout>\n          <Box>\n            <Box mb=\"24px\">\n              <Label htmlFor=\"name\">{t('Title')}</Label>\n              <Input id=\"name\" name=\"name\" value={name} scale=\"lg\" onChange={handleChange} required />\n              {formErrors.name && fieldsState.name && <FormErrors errors={formErrors.name} />}\n            </Box>\n            <Box mb=\"24px\">\n              <Label htmlFor=\"body\">{t('Content')}</Label>\n              <Text color=\"textSubtle\" mb=\"8px\">\n                {t('Tip: write in Markdown!')}\n              </Text>\n              <EasyMde\n                id=\"body\"\n                name=\"body\"\n                onTextChange={handleEasyMdeChange}\n                value={body}\n                options={options}\n                required\n              />\n              {formErrors.body && fieldsState.body && <FormErrors errors={formErrors.body} />}\n            </Box>\n            {body && (\n              <Box mb=\"24px\">\n                <Card>\n                  <CardHeader>\n                    <Heading as=\"h3\" scale=\"md\">\n                      {t('Preview')}\n                    </Heading>\n                  </CardHeader>\n                  <CardBody p=\"0\" px=\"24px\">\n                    <ReactMarkdown>{body}</ReactMarkdown>\n                  </CardBody>\n                </Card>\n              </Box>\n            )}\n            <Choices choices={choices} onChange={handleChoiceChange} />\n            {formErrors.choices && fieldsState.choices && <FormErrors errors={formErrors.choices} />}\n          </Box>\n          <Box>\n            <Card>\n              <CardHeader>\n                <Heading as=\"h3\" scale=\"md\">\n                  {t('Actions')}\n                </Heading>\n              </CardHeader>\n              <CardBody>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('Start Date')}</SecondaryLabel>\n                  <DatePicker\n                    name=\"startDate\"\n                    onChange={handleDateChange('startDate')}\n                    selected={startDate}\n                    placeholderText=\"YYYY/MM/DD\"\n                  />\n                  {formErrors.startDate && fieldsState.startDate && <FormErrors errors={formErrors.startDate} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('Start Time')}</SecondaryLabel>\n                  <TimePicker\n                    name=\"startTime\"\n                    onChange={handleDateChange('startTime')}\n                    selected={startTime}\n                    placeholderText=\"00:00\"\n                  />\n                  {formErrors.startTime && fieldsState.startTime && <FormErrors errors={formErrors.startTime} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('End Date')}</SecondaryLabel>\n                  <DatePicker\n                    name=\"endDate\"\n                    onChange={handleDateChange('endDate')}\n                    selected={endDate}\n                    placeholderText=\"YYYY/MM/DD\"\n                  />\n                  {formErrors.endDate && fieldsState.endDate && <FormErrors errors={formErrors.endDate} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('End Time')}</SecondaryLabel>\n                  <TimePicker\n                    name=\"endTime\"\n                    onChange={handleDateChange('endTime')}\n                    selected={endTime}\n                    placeholderText=\"00:00\"\n                  />\n                  {formErrors.endTime && fieldsState.endTime && <FormErrors errors={formErrors.endTime} />}\n                </Box>\n                {account && (\n                  <Flex alignItems=\"center\" mb=\"8px\">\n                    <Text color=\"textSubtle\" mr=\"16px\">\n                      {t('Creator')}\n                    </Text>\n                    <LinkExternal href={getBscScanLink(account, 'address')}>\n                      {truncateWalletAddress(account)}\n                    </LinkExternal>\n                  </Flex>\n                )}\n                <Flex alignItems=\"center\" mb=\"16px\">\n                  <Text color=\"textSubtle\" mr=\"16px\">\n                    {t('Snapshot')}\n                  </Text>\n                  <LinkExternal href={getBscScanLink(snapshot, 'block')}>{snapshot}</LinkExternal>\n                </Flex>\n                {account ? (\n                  <>\n                    <Button\n                      type=\"submit\"\n                      width=\"100%\"\n                      isLoading={isLoading}\n                      endIcon={isLoading ? <AutoRenewIcon spin color=\"currentColor\" /> : null}\n                      disabled={!isEmpty(formErrors)}\n                      mb=\"16px\"\n                    >\n                      {t('Publish')}\n                    </Button>\n                    <Text color=\"failure\" as=\"p\" mb=\"4px\">\n                      {t('You need at least %count% voting power to publish a proposal.', { count: VOTE_THRESHOLD })}{' '}\n                    </Text>\n                    <Button scale=\"sm\" type=\"button\" variant=\"text\" onClick={onPresentVoteDetailsModal} p={0}>\n                      {t('Check voting power')}\n                    </Button>\n                  </>\n                ) : (\n                  <ConnectWalletButton width=\"100%\" type=\"button\" />\n                )}\n              </CardBody>\n            </Card>\n          </Box>\n        </Layout>\n      </form>\n    </Container>\n  )\n}\n\nexport default CreateProposal\n"]},"metadata":{},"sourceType":"module"}